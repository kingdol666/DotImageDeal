# 🔬 Dark Particle Analyzer - 深色粒子分析器

## ✨ 简介

**Dark Particle Analyzer** 是一款功能强大的图像处理工具，专为自动识别、标记和分析图像中的深色粒子而设计。无论您是需要进行材料科学研究、质量控制检测，还是任何其他需要量化图像中微小特征的场景，本软件都能提供精准、高效的解决方案。

通过友好的图形用户界面（GUI），即便是非专业用户也能轻松上手，调整各项参数以获得最佳的分析结果。

## 🌟 主要功能

- **🎨 多种标记模式**：
  - **标准模式 (Standard)**: 使用统一的红色快速标记所有识别出的粒子。
  - **渐变模式 (Gradient)**: 根据粒子的暗度应用不同深浅的红色，暗度越高，颜色越深，结果更具表现力。
  - **聚类模式 (Clustering)**: 自动将邻近的粒子分组，并为每个粒子簇分配独特的颜色，便于分析粒子分布。
- **🎛️ 精准的参数控制**：通过滑块和输入框，实时调整灵敏度、模糊半径、边框宽度等核心参数，并立即在界面上看到效果。
- **🖱️ 区域选择分析**：使用鼠标在图像上拖拽出一个矩形选框，软件将只对该区域进行分析，适用于处理大图中的特定部分。
- **🔬 粒子尺寸筛选**：轻松设置最小和最大粒子面积，过滤掉不符合尺寸要求的噪点或背景。
- **🏭 批量处理**：一次性处理多个图像文件，并将结果保存到指定文件夹，极大提升工作效率。
- **🎨 主题切换**：内置深色与浅色两套主题，适应不同光照环境下的使用习惯。

---

## 🚀 如何使用

### 步骤1：📂 加载图像

1.  点击窗口右上角的 **`Load Image`** 按钮。
2.  在弹出的文件对话框中，选择一张您需要分析的图片（支持 `.png`, `.jpg`, `.bmp` 等格式）。
3.  加载成功后，图像会显示在左侧的 “Work Space” 区域。

### 步骤2：🖱️ 选择分析区域

1.  将鼠标移动到左侧的原始图像上，光标会变成十字形。
2.  按住鼠标左键并拖动，可以画出一个蓝色的矩形选框。
3.  松开鼠标后，软件会自动对选框内的区域进行处理，并在右侧显示结果。
4.  您可以随时拖动或重新绘制选框，软件会实时更新分析结果。

> **💡 提示**：如果您想移动已画好的选框，只需将鼠标移动到选框内部（光标会变成四向箭头），然后按住左键拖动即可。

### 步骤3：⚙️ 调整参数

在窗口的右侧是 **控制面板 (Control Panel)**，您可以在这里调整所有分析参数。每次调整后，处理结果都会自动刷新。

#### Processing Mode (处理模式)

通过下拉菜单选择一种处理模式：

- **Standard**: 最基础的模式，所有粒子都标记为纯红色。
- **Gradient**: 粒子颜色会根据其暗度从浅红到深红渐变。
- **Clustering**: 对粒子进行聚类，用不同颜色区分不同的粒子簇。

#### Processing Parameters (核心处理参数)

- **Sensitivity Min (灵敏度下限)**:
  - **作用**: 控制识别最“浅”的深色粒子的标准。值越低，越容易将较浅的灰色区域也识别为粒子。
  - **如何调整**: 如果想识别更多颜色较浅的粒子，请降低此值。如果只想识别非常暗的粒子，请提高此值。
  - **范围**: 0.0 ~ 1.0

- **Sensitivity Max (灵敏度上限)**:
  - **作用**: 控制识别最“深”的深色粒子的标准。值越高，即便是接近纯黑色的区域也会被识别。
  - **如何调整**: 通常保持在较高值（如0.9-1.0）即可。如果发现某些最暗的核心区域没有被正确识别，可以适当调低此值。
  - **范围**: 0.0 ~ 1.0

- **Blur Radius (模糊半径)**:
  - **作用**: 这是软件用来判断“背景”亮度的关键参数。它会根据这个半径大小的区域来计算局部背景光，从而更好地适应光照不均的图像。
  - **如何调整**: **此值应略大于您想识别的最大粒子的半径**。如果设置得太小，大粒子可能会被忽略；如果太大，可能会影响对小物体的识别精度。
  - **范围**: 1 ~ 100

- **Border Width (边框宽度)**:
  - **作用**: 忽略图像边缘指定宽度的区域，防止将图像边框或边缘伪影识别为粒子。
  - **如何调整**: 如果您的图像有黑边或不希望分析边缘区域，请将此值设置为相应的像素宽度。
  - **范围**: 0 ~ 100

#### Particle Size Filter (粒子尺寸筛选)

- **Min Particle Size (最小粒子面积)**:
  - **作用**: 过滤掉面积小于此值的粒子。非常适合用于去除微小的噪点。
  - **如何调整**: 观察图像中的噪点，适当增大此值，直到噪点消失但目标粒子仍然保留。设置为0则不进行最小尺寸限制。
  - **范围**: 0 ~ 10000 (像素面积)

- **Max Particle Size (最大粒子面积)**:
  - **作用**: 过滤掉面积大于此值的粒子。
  - **如何调整**: 如果图像中有一些您不想识别的大面积暗色背景，可以设置此值将其排除。设置为0则不进行最大尺寸限制。
  - **范围**: 0 ~ 100000 (像素面积)

#### Clustering Parameters (聚类参数)

> **⚠️ 注意**: 此区域仅在 **Processing Mode** 设置为 **Clustering** 时可见并生效。

- **Cluster EPS**:
  - **作用**: 定义了粒子之间被视为“邻居”的最大距离。值越小，只有非常靠近的粒子才会被归为一簇。
  - **如何调整**: 如果希望将距离较远的粒子也合并到同一簇，请增大此值。反之，则减小此值。
  - **范围**: 1 ~ 500

- **Min Samples (最少样本数)**:
  - **作用**: 定义一个粒子簇最少需要包含多少个粒子。
  - **如何调整**: 提高此值可以过滤掉由少数几个粒子组成的稀疏小簇，使结果更关注密集的粒子群。
  - **范围**: 1 ~ 50

### 步骤4：📊 查看结果

- **右侧图像**: 显示经过处理和标记后的图像。
- **底部状态栏**:
  - **Particle Percentage**: 标记的粒子总面积占选框内总面积的百分比。
  - **Particle Count**: 选框内识别出的粒子总数量。
  - **Cluster Count**: (仅在聚类模式下显示) 识别出的粒子簇的数量。

### 步骤5：💾 保存与清除

- **`Save Result`**: 点击此按钮，可以将右侧处理后的图像保存到您的电脑。
- **`Clear Selection`**: 点击此按钮，将清除当前的选框和处理结果，方便您重新选择区域。

---

## 🏭 批量处理

如果您有多张结构相似的图像需要使用同一套参数进行处理，可以使用批量处理功能。

1.  首先，按照上述步骤处理一张样本图像，并调整好所有参数。
2.  在 **Batch Processing** 区域，点击 **`Browse...`** 按钮选择一个用于存放结果的文件夹。
3.  点击 **`Batch Process`** 按钮。
4.  在弹出的文件对话框中，按住 `Ctrl` 或 `Shift` 键选择多张需要处理的图片。
5.  软件会自动将所有选中的图片应用当前设置的参数进行处理，并将结果保存到您选择的输出文件夹中。

## 📧 联系作者

如果您在使用过程中遇到任何问题或有功能建议，欢迎通过以下方式联系我：

- **作者邮箱**: zhanghaozheng@mail.ustc.edu.cn

---
*Happy analyzing!* 🎉
